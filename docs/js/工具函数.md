---
slug: utils
tags: [js, utils]
---

## å»é‡
```js
/**
 * å»é‡
 */
handleDeduplicate(sourceArray,keyName) {
  let deduplicationList = [];
  let obj = {};
  for (let item of sourceArray) {
    if (!obj[item[keyName]]) {
      deduplicationList.push(item);
      obj[item[keyName]] = 1;
    }
  }
  return deduplicationList;
},
```

## å¾ªç¯åˆ æ•°ç»„å…ƒç´ 
<CodeRun>
{`
var arr = [1,2,2,3,4,5];
var i = arr.length;
// ä»åå¾€å‰éå†
while (i--) {
  if (arr[i] == 2) {
    arr.splice(i,1);
  }
}
console.log(arr);
`}
</CodeRun>

ä¹Ÿå¯ä»¥ä½¿ç”¨`filter`å®ç°:
<CodeRun>
{`
var stuArr = [
  {name:'Jesse',gender:'male'},
  {name:'Leo',gender:'male'},
  {name:'Sophia',gender:'female'},
  {name:'Kathy',gender:'female'},
  {name:'Gaviin',gender:'male'}
];
stuArr = stuArr.filter(function (item) {
  return item.gender !== 'male';
});
console.log( stuArr );
// åˆ é™¤åæ•°ç»„å½“å‰å€¼: [ {name:'Sophia',gender:'female'}, {name:'Kathy',gender:'female'} ]
`}
</CodeRun>

## ä½¿ç”¨`weakmap`å®ç°æ·±æ‹·è´
```js
/**
 * ä½¿ç”¨weakmapæ‰‹å†™æ·±æ‹·è´
 */
deepClone(obj, hash = new WeakMap()) {
  const isComplexDataType = obj => (typeof obj === 'object' || typeof obj === 'function') && (obj !== null);
  if (obj.constructor === Date) return new Date(obj);
  if (obj.constructor === RegExp) return new RegExp(obj);
  if (hash.has(obj)) return hash.get(obj);
  let allDesc = Object.getOwnPropertyDescriptor(obj);
  let cloneObj = Object.create(Object.getPrototypeOf(obj), allDesc);
  hash.set(obj, cloneObj);
  for (const key of Reflect.ownKeys(obj)) {
    cloneObj[key] = (isComplexDataType(obj[key]) && typeof obj[key] !== 'function') ? this.deepClone(obj[key], hash) : obj[key];
  }
  return cloneObj;
},
```

## æ•°ç»„è½¬æ ‘ï¼›æ ‘è½¬æ•°ç»„
> å‚è€ƒï¼š[listå’Œtreeçš„ç›¸äº’è½¬æ¢](https://juejin.cn/post/6952442048708345863)

## æ­£åˆ™è¡¨è¾¾å¼
### æå–å°æ‹¬å·ä¸­çš„å†…å®¹
```jsx live
function demo(props) {
  // æå–å°æ‹¬å·ä¸­çš„å†…å®¹
  let sourceStr = 'aa(bb)cc';
  let regex = /\((.+)\)/g; // åŒ¹é…å°æ‹¬å·
  let tempString = sourceStr.match(regex)[0];
  let result = tempString.substring(1,tempString.length-1);

  return (
    <p>ç»“æœä¸ºï¼š{result}</p>
  )
}
```

### æ‰‹æœºå·ç ä¸­é—´ 4 ä½ç”¨æ˜Ÿå·ï¼ˆ*ï¼‰æ›¿æ¢æ˜¾ç¤º
```jsx live
function demo(props) {
  // æ‰‹æœºå·ç ä¸­é—´ 4 ä½ç”¨æ˜Ÿå·ï¼ˆ*ï¼‰æ›¿æ¢æ˜¾ç¤º
  let phone = '13701134148';
  let result = phone.replace(/^(\d{3})\d{4}(\d+)/, '$1****$2');

  return (
    <p>ç»“æœä¸ºï¼š{result}</p>
  )
}
```

### æ‰‹æœºå·æœ‰æ•ˆæ€§æ ¡éªŒ
```js
if (!(/^1[3456789]\d{9}$/.test(phone))) return Toast.show({ content: 'æ‰‹æœºå·éœ€æ˜¯11ä½æœ‰æ•ˆæ‰‹æœºå·' });
```

### è¿‡æ»¤è¡¨æƒ…ç¬¦å·
åœ¨ JavaScript ä¸­ï¼Œå¯ä»¥ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æ¥è¿‡æ»¤æ‰å­—ç¬¦ä¸²ä¸­çš„è¡¨æƒ…ç¬¦å·ã€‚è¡¨æƒ…ç¬¦å·é€šå¸¸ä½äº Unicode çš„ç‰¹å®šèŒƒå›´å†…ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Unicode èŒƒå›´æ¥åŒ¹é…è¿™äº›è¡¨æƒ…ç¬¦å·ã€‚

ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹ä»£ç ï¼Œå±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æ¥è¿‡æ»¤æ‰å­—ç¬¦ä¸²ä¸­çš„è¡¨æƒ…ç¬¦å·ï¼š

```javascript
function removeEmojis(str) {
  // æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…è¡¨æƒ…ç¬¦å·
  const emojiRegex = /[\u{1F600}-\u{1F64F}]|[\u{1F300}-\u{1F5FF}]|[\u{1F680}-\u{1F6FF}]|[\u{1F700}-\u{1F77F}]|[\u{1F780}-\u{1F7FF}]|[\u{1F800}-\u{1F8FF}]|[\u{1F900}-\u{1F9FF}]|[\u{1FA00}-\u{1FA6F}]|[\u{1FA70}-\u{1FAFF}]|[\u{2600}-\u{26FF}]|[\u{2700}-\u{27BF}]|[\u{1F1E6}-\u{1F1FF}]|[\u{1F201}-\u{1F251}]|[\u{1F004}-\u{1F0CF}]|[\u{1F18E}-\u{1F1AD}]|[\u{1F191}-\u{1F19A}]|[\u{1F232}-\u{1F23A}]|[\u{1F250}-\u{1F251}]|[\u{1F300}-\u{1F320}]|[\u{1F32D}-\u{1F335}]|[\u{1F337}-\u{1F37C}]|[\u{1F37E}-\u{1F393}]|[\u{1F3A0}-\u{1F3CA}]|[\u{1F3CF}-\u{1F3D3}]|[\u{1F3E0}-\u{1F3F0}]|[\u{1F3F4}-\u{1F3F8}]|[\u{1F400}-\u{1F43E}]|[\u{1F440}-\u{1F4FC}]|[\u{1F4FF}-\u{1F53D}]|[\u{1F54B}-\u{1F54E}]|[\u{1F550}-\u{1F567}]|[\u{1F57A}-\u{1F57A}]|[\u{1F595}-\u{1F596}]|[\u{1F5A4}-\u{1F5A4}]|[\u{1F5FB}-\u{1F64F}]|[\u{1F680}-\u{1F6C5}]|[\u{1F6CC}-\u{1F6CC}]|[\u{1F6D0}-\u{1F6D2}]|[\u{1F6EB}-\u{1F6EC}]|[\u{1F6F4}-\u{1F6F9}]|[\u{1F910}-\u{1F93A}]|[\u{1F93C}-\u{1F945}]|[\u{1F947}-\u{1F9FF}]|[\u{1FA70}-\u{1FA73}]|[\u{1FA78}-\u{1FA7A}]|[\u{1FA80}-\u{1FA82}]|[\u{1FA90}-\u{1FA95}]|[\u{1F004}-\u{1F004}]|[\u{1F0CF}-\u{1F0CF}]|[\u{1F170}-\u{1F171}]|[\u{1F17E}-\u{1F17F}]|[\u{1F18E}-\u{1F18E}]|[\u{1F191}-\u{1F19A}]|[\u{1F1E6}-\u{1F1FF}]|[\u{1F201}-\u{1F202}]|[\u{1F21A}-\u{1F21A}]|[\u{1F22F}-\u{1F22F}]|[\u{1F232}-\u{1F23A}]|[\u{1F250}-\u{1F251}]|[\u{1F300}-\u{1F320}]|[\u{1F32D}-\u{1F335}]|[\u{1F337}-\u{1F37C}]|[\u{1F37E}-\u{1F393}]|[\u{1F3A0}-\u{1F3CA}]|[\u{1F3CF}-\u{1F3D3}]|[\u{1F3E0}-\u{1F3F0}]|[\u{1F3F4}-\u{1F3F8}]|[\u{1F400}-\u{1F43E}]|[\u{1F440}-\u{1F4FC}]|[\u{1F4FF}-\u{1F53D}]|[\u{1F54B}-\u{1F54E}]|[\u{1F550}-\u{1F567}]|[\u{1F57A}-\u{1F57A}]|[\u{1F595}-\u{1F596}]|[\u{1F5A4}-\u{1F5A4}]|[\u{1F5FB}-\u{1F64F}]|[\u{1F680}-\u{1F6C5}]|[\u{1F6CC}-\u{1F6CC}]|[\u{1F6D0}-\u{1F6D2}]|[\u{1F6EB}-\u{1F6EC}]|[\u{1F6F4}-\u{1F6F9}]|[\u{1F910}-\u{1F93A}]|[\u{1F93C}-\u{1F945}]|[\u{1F947}-\u{1F9FF}]|[\u{1FA70}-\u{1FA73}]|[\u{1FA78}-\u{1FA7A}]|[\u{1FA80}-\u{1FA82}]|[\u{1FA90}-\u{1FA95}]/gu;

  // ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æ›¿æ¢è¡¨æƒ…ç¬¦å·ä¸ºç©ºå­—ç¬¦ä¸²
  return str.replace(emojiRegex, '');
}

// ç¤ºä¾‹
const stringWithEmojis = "Hello, world! ğŸŒğŸ˜Š";
const stringWithoutEmojis = removeEmojis(stringWithEmojis);
console.log(stringWithoutEmojis); // è¾“å‡º: "Hello, world! "
```

å…³é”®ç‚¹è§£é‡Šï¼š
1. **æ­£åˆ™è¡¨è¾¾å¼**ï¼š
   - ä½¿ç”¨ Unicode èŒƒå›´æ¥åŒ¹é…è¡¨æƒ…ç¬¦å·ã€‚æ­£åˆ™è¡¨è¾¾å¼ä¸­çš„ `\u{XXXXXX}` è¡¨ç¤º Unicode ä»£ç ç‚¹ï¼Œéœ€è¦ä½¿ç”¨ `u` æ ‡å¿—æ¥å¯ç”¨ Unicode æ¨¡å¼ã€‚
   - ç”±äºè¡¨æƒ…ç¬¦å·åˆ†å¸ƒåœ¨å¤šä¸ª Unicode èŒƒå›´å†…ï¼Œå› æ­¤éœ€è¦ä½¿ç”¨å¤šä¸ªèŒƒå›´æ¥åŒ¹é…æ‰€æœ‰å¯èƒ½çš„è¡¨æƒ…ç¬¦å·ã€‚

2. **æ›¿æ¢è¡¨æƒ…ç¬¦å·**ï¼š
   - ä½¿ç”¨ `String.prototype.replace` æ–¹æ³•ï¼Œå°†åŒ¹é…åˆ°çš„è¡¨æƒ…ç¬¦å·æ›¿æ¢ä¸ºç©ºå­—ç¬¦ä¸²ã€‚

### è¿‡æ»¤ç©ºæ ¼å’Œå›è½¦ç¬¦
åœ¨ JavaScript ä¸­ï¼Œå¯ä»¥ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æ¥è¿‡æ»¤æ‰å­—ç¬¦ä¸²ä¸­çš„ç©ºæ ¼å’Œå›è½¦ç¬¦ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹ä»£ç ï¼Œå±•ç¤ºäº†å¦‚ä½•å®ç°è¿™ä¸€åŠŸèƒ½ï¼š

```javascript
function removeWhitespaceAndNewlines(str) {
  // æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ç©ºæ ¼å’Œå›è½¦ç¬¦
  const whitespaceAndNewlineRegex = /\s+/g;

  // ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æ›¿æ¢ç©ºæ ¼å’Œå›è½¦ç¬¦ä¸ºç©ºå­—ç¬¦ä¸²
  return str.replace(whitespaceAndNewlineRegex, '');
}

// ç¤ºä¾‹
const stringWithWhitespaceAndNewlines = "Hello, \n world! \t This is a test.  ";
const stringWithoutWhitespaceAndNewlines = removeWhitespaceAndNewlines(stringWithWhitespaceAndNewlines);
console.log(stringWithoutWhitespaceAndNewlines); // è¾“å‡º: "Hello,world!Thisisatest."
```

å…³é”®ç‚¹è§£é‡Šï¼š
1. **æ­£åˆ™è¡¨è¾¾å¼**ï¼š
   - `\s` åŒ¹é…ä»»ä½•ç©ºç™½å­—ç¬¦ï¼ŒåŒ…æ‹¬ç©ºæ ¼ã€åˆ¶è¡¨ç¬¦ã€æ¢é¡µç¬¦ã€å›è½¦ç¬¦ã€æ¢è¡Œç¬¦ç­‰ã€‚
   - `+` è¡¨ç¤ºåŒ¹é…å‰é¢çš„æ¨¡å¼ä¸€æ¬¡æˆ–å¤šæ¬¡ã€‚
   - `g` æ ‡å¿—è¡¨ç¤ºå…¨å±€åŒ¹é…ï¼Œå³åŒ¹é…å­—ç¬¦ä¸²ä¸­çš„æ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„å­å­—ç¬¦ä¸²ã€‚

2. **æ›¿æ¢ç©ºæ ¼å’Œå›è½¦ç¬¦**ï¼š
   - ä½¿ç”¨ `String.prototype.replace` æ–¹æ³•ï¼Œå°†åŒ¹é…åˆ°çš„ç©ºæ ¼å’Œå›è½¦ç¬¦æ›¿æ¢ä¸ºç©ºå­—ç¬¦ä¸²ã€‚

## åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡æ˜¯ä¸æ˜¯ä¸€ä¸ªç©ºå¯¹è±¡
[ä½¿ç”¨Reflect.ownKeysåˆ¤æ–­å¯¹è±¡è‡ªèº«ä¸ºç©º](https://mp.weixin.qq.com/s/0vSXkIgoGNIGN6mNOTQCiA)

<CodeRun>{`
const a = Symbol()
const obj1 = {
  [a]: 1
}
const obj2 = {b: 2}
const obj3 = {}
Object.defineProperty(obj3, 'a', {
  value: 1,
  enumerable: false
})
const obj4 = {}
// æµ‹è¯•
console.log(Reflect.ownKeys(obj1).length === 0)  // false
console.log(Reflect.ownKeys(obj2).length === 0)  // false
console.log(Reflect.ownKeys(obj3).length === 0)  // false
console.log(Reflect.ownKeys(obj4).length === 0)  // true
`}</CodeRun>

## å¤åˆ¶
```js
function handleCopy(copyValue: string) {
  if (!navigator.clipboard) {
    // 1.åˆ›å»ºä¸€ä¸ªå¯é€‰ä¸­å…ƒç´ 
    let textArea = document.createElement("textarea");
    textArea.value = copyValue;
    // 2.ä½¿ç”¨å®šä½ï¼Œé˜»æ­¢é¡µé¢æ»šåŠ¨
    textArea.style.top = "0";
    textArea.style.left = "0";
    textArea.style.position = "fixed";
    document.body.appendChild(textArea);
    textArea.focus();
    textArea.select();
    try {
      let successFlag = document.execCommand('copy');
      if (successFlag) {
        Toast.show({
          content: 'å¤åˆ¶æˆåŠŸ',
        });
      } else {
        Toast.show({
          content: 'å¤åˆ¶å¤±è´¥',
        });
      }
    } catch (err) {
      Toast.show({
        content: 'å¤åˆ¶å¤±è´¥',
      });
    }
    // 3.ç§»é™¤å…ƒç´ 
    document.body.removeChild(textArea);
    return;
  }
  navigator.clipboard.writeText(copyValue).then(function() {
    Toast.show({
      content: 'å¤åˆ¶æˆåŠŸ',
    });
  }, function(_err) {
    Toast.show({
      content: 'å¤åˆ¶å¤±è´¥',
    });
  });
}
```

## è·å– URL ä¸­çš„æŸ¥è¯¢å‚æ•°
åœ¨ JavaScript ä¸­ï¼Œæœ‰å¤šç§æ–¹æ³•å¯ä»¥è·å– URL ä¸­çš„æŸ¥è¯¢å‚æ•°ã€‚ä»¥ä¸‹æ˜¯å‡ ç§å¸¸è§çš„æ–¹æ³•ï¼š

### æ–¹æ³•ä¸€ï¼šä½¿ç”¨ `URLSearchParams`

`URLSearchParams` æ˜¯ä¸€ä¸ªç°ä»£çš„ã€ç®€æ´çš„ APIï¼Œå¯ä»¥æ–¹ä¾¿åœ°è§£ææŸ¥è¯¢å‚æ•°ã€‚

ç¤ºä¾‹ä»£ç :
```javascript
// å‡è®¾å½“å‰ URL æ˜¯ http://example.com/?name=John&age=30

// è·å–å½“å‰ URL çš„æŸ¥è¯¢å­—ç¬¦ä¸²
const queryString = window.location.search;

// åˆ›å»º URLSearchParams å¯¹è±¡
const urlParams = new URLSearchParams(queryString);

// è·å–ç‰¹å®šå‚æ•°
const name = urlParams.get('name'); // "John"
const age = urlParams.get('age'); // "30"

// è¾“å‡ºå‚æ•°
console.log(`Name: ${name}, Age: ${age}`);
```

### æ–¹æ³•äºŒï¼šä½¿ç”¨ `URL` å¯¹è±¡ï¼ˆç°ä»£æµè§ˆå™¨ï¼‰

`URL` å¯¹è±¡åœ¨ç°ä»£æµè§ˆå™¨ä¸­ä¹Ÿéå¸¸æ–¹ä¾¿ï¼Œå¯ä»¥ç›´æ¥è§£æ URL å’ŒæŸ¥è¯¢å‚æ•°ã€‚

ç¤ºä¾‹ä»£ç :
```javascript
// å‡è®¾å½“å‰ URL æ˜¯ http://example.com/?name=John&age=30

// åˆ›å»ºä¸€ä¸ª URL å¯¹è±¡
const url = new URL(window.location.href);

// è·å–ç‰¹å®šå‚æ•°
const name = url.searchParams.get('name'); // "John"
const age = url.searchParams.get('age'); // "30"

// è¾“å‡ºå‚æ•°
console.log(`Name: ${name}, Age: ${age}`);
```

### æ–¹æ³•ä¸‰ï¼šä¸ä½¿ç”¨ç°ä»£æµè§ˆå™¨çš„API
éœ€è¦å…¼å®¹æ—§æµè§ˆå™¨çš„åœºæ™¯

ç¤ºä¾‹ä»£ç :
```js
function getQueryParams() {
  const query = window.location.search;
  const params: any = {};
  const pairs = query.substring(1).split('&');
  for (let i = 0; i < pairs.length; i++) {
    const pair = pairs[i].split('=');
    params[decodeURIComponent(pair[0])] = decodeURIComponent(pair[1]);
  }
  return params;
}
```
